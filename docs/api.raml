#%RAML 1.0
title: DPV API
description: API to get data about DPV
version: '1.0'
baseUri: http://localhost:8080/dpv/
mediaType: application/json
types:
  User: !include types/User.raml
  Club: !include types/Club.raml
  Membership: !include types/Membership.raml
  ErrorResponse: !include types/errorResponse.raml
securitySchemes:
  basicAuth:
    type: Basic Authentication

/users:
  post:
    description: Register a new user
    body:
      application/json:
        type: object
        properties:
          email: string
          password: string
          name: string
          vorname: string
    responses:
      200:
        description: User created
        body:
          application/json:
            type: User
  /me:
    get:
      description: Get the current authenticated user
      securedBy: [ basicAuth ]
      responses:
        200:
          description: Current user details
          body:
            application/json:
              type: User
    patch:
      description: Update the current authenticated user
      securedBy: [ basicAuth ]
      body:
        application/json:
          type: object
          properties:
            name: string
            vorname: string
      responses:
        200:
          description: Updated user details
          body:
            application/json:
              type: User
  /request-email-validation:
    post:
      description: Request a validation email for the user's email address. Requires authentication.
      securedBy: [ basicAuth ]
      body:
        application/json:
          type: object
          properties:
            email:
              type: string
              required: false
              description: Optional. If provided, sends validation to this email; otherwise uses user's current email.
      responses:
        200:
          description: Validation email sent
          body:
            application/json:
              type: ErrorResponse
        400:
          description: Bad request (missing/invalid data)
          body:
            application/json:
              type: ErrorResponse
  /validate-email:
    get:
      description: Validate a user's email address using query parameters from the validation link.
      queryParameters:
        key:
          type: string
          required: true
          description: User key
        expiry:
          type: string
          required: true
          description: Expiry timestamp
        email:
          type: string
          required: true
          description: Email address to validate
        token:
          type: string
          required: true
          description: Validation token
      responses:
        200:
          description: Email successfully validated (returns HTML)
          body:
            text/html:
              example: |
                <!DOCTYPE html>
                <html lang="de">
                <head>
                  <meta charset="UTF-8">
                  <title>E-Mail best√§tigt - DPV</title>
                </head>
                <body>
                  <h1>‚úÖ E-Mail-Adresse erfolgreich best√§tigt!</h1>
                </body>
                </html>
        400:
          description: Bad request (missing/invalid parameters)
          body:
            application/json:
              type: ErrorResponse

  /request-password-reset:
    post:
      description: Request a password reset email for the given email address.
      body:
        application/json:
          type: object
          properties:
            email:
              type: string
              required: true
              description: The email address to send the password reset link to.
      responses:
        200:
          description: Password reset email sent
          body:
            application/json:
              type: ErrorResponse
        400:
          description: Bad request (missing/invalid data)
          body:
            application/json:
              type: ErrorResponse
  /reset-password:
    get:
      description: Show password reset HTML form. Query parameters are passed from the email link.
      queryParameters:
        key:
          type: string
          required: true
          description: User key
        expiry:
          type: string
          required: true
          description: Expiry timestamp
        token:
          type: string
          required: true
          description: Password reset token
      responses:
        200:
          description: Password reset form (HTML with JavaScript for JSON POST)
          body:
            text/html:
              example: |
                <!DOCTYPE html>
                <html lang="de">
                <head>
                  <meta charset="UTF-8">
                  <title>Passwort zur√ºcksetzen - DPV</title>
                </head>
                <body>
                  <h1>üîí Passwort zur√ºcksetzen</h1>
                </body>
                </html>
        400:
          description: Bad request (missing/invalid parameters)
          body:
            application/json:
              type: ErrorResponse
    post:
      description: Handle password reset. Expects all variables as JSON in POST body.
      body:
        application/json:
          type: object
          properties:
            key:
              type: string
              required: true
            expiry:
              type: string
              required: true
            token:
              type: string
              required: true
            password:
              type: string
              required: true
            confirm:
              type: string
              required: true
      responses:
        200:
          description: Password successfully changed (returns JSON)
          body:
            application/json:
              type: ErrorResponse
        400:
          description: Bad request (missing/invalid parameters or passwords do not match)
          body:
            application/json:
              type: ErrorResponse
/admin/users/{key}/roles:
  patch:
    description: Update a user's roles (Admin only)
    securedBy: [ basicAuth ]
    body:
      application/json:
        type: object
        properties:
          roles:
            type: string[]
            example: ["admin", "active-admin"]
    responses:
      200:
        description: Roles updated successfully
        body:
          application/json:
            type: User
      403:
        description: Forbidden - requires global admin

/clubs:
  securedBy: [ basicAuth ]
  post:
    description: Create a new club
    body:
      application/json:
        type: object
        properties:
          name:
            type: string
            example: "Parkour Club e.V."
          rechtsform:
            type: string
            example: "e.V."
          mitgliedsstatus:
            type: string
            required: false
            example: "mitglied"
          email:
            type: string
            required: false
            example: "info@parkour-club.de"
          adresse:
            type: string
            required: false
            example: "Musterstra√üe 1, 12345 Musterstadt"
    responses:
      200:
        description: Club created
        body:
          application/json:
            type: Club
  get:
    description: List clubs. Admins see all clubs with pagination/filtering; users see clubs they administer.
    queryParameters:
      status?:
        type: string
        description: Filter by Mitgliedsstatus (none, requested, approved, denied, cancelled)
      skip?:
        type: integer
        default: 0
      limit?:
        type: integer
        default: 100
    responses:
      200:
        description: List of clubs
        body:
          application/json:
            type: Club[]
  /{key}:
    get:
      description: Get details of a specific club
      responses:
        200:
          description: Club details
          body:
            application/json:
              type: Club
        403:
          description: Unauthorized
    patch:
      description: Partially update a club
      body:
        application/json:
          type: object
          properties:
            name:
              type: string
              required: false
              example: "Parkour Club e.V."
            rechtsform:
              type: string
              required: false
              example: "e.V."
            email:
              type: string
              required: false
              example: "info@parkour-club.de"
            adresse:
              type: string
              required: false
              example: "Musterstra√üe 1, 12345 Musterstadt"
            mitglieder:
              type: integer
              required: false
              example: 100
            stimmen:
              type: integer
              required: false
              example: 5
            mitgliedsstatus:
              type: string
              required: false
              enum: [none, requested, approved, denied, cancelled]
      responses:
        200:
          description: Updated club details
          body:
            application/json:
              type: Club
    delete:
      description: Delete a club
      responses:
        204:
          description: Club deleted
    /apply:
      post:
        description: Apply for membership
        responses:
          200:
            description: Application submitted
    /approve:
      post:
        description: Approve membership application (Admin only)
        responses:
          200:
            description: Membership approved
    /deny:
      post:
        description: Deny membership application (Admin only)
        responses:
          200:
            description: Membership denied
    /cancel:
      post:
        description: Cancel or reset membership
        responses:
          200:
            description: Membership cancelled/reset
    /documents:
      post:
        description: Upload a document for the club
        body:
          multipart/form-data:
            properties:
              document:
                type: file
                description: The document to upload
        responses:
          200:
            description: Document uploaded successfully
            body:
              application/json:
                type: object
                properties:
                  message: string
                  filename: string

/version:
  get:
    description: Returns the version of the API - the only endpoint that does not use JSON-formatted response, i.e. no quotes around version string
    responses:
      '200':
        description: OK
        body:
          type: string
          example: "42"